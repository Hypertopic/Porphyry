services: couchdb

language: 
- php
- java
- python
- node_js

php:
  - '5.4'
  - '5.5'
  - '5.6'
  - '7.0'

node_js: stable

cache:
  directories:
  - $HOME/.cache/pip/

sudo: required

install : 
#Installation Couchapp
- pip install --user couchapp  
#Installation ARGOS
- git clone https://github.com/Hypertopic/Argos.git
- cd Argos
- curl -X PUT http://127.0.0.1:5984/argos
- couchapp init
- couchapp push http://127.0.0.1:5984/argos
- curl http://127.0.0.1:5984/argos
- cd ..
- curl http://127.0.0.1:5984/test/_design/argos/_rewrite/
# Install Cassandre
- curl -X PUT -d '"false"' localhost:5984/_config/httpd/secure_rewrites
- curl -X PUT localhost:5984/cassandre
- wget https://github.com/Ozymandiiaz/Cassandre/archive/travis-test.zip
- unzip travis-test.zip
- couchapp push  Cassandre-travis-test http://localhost:5984/cassandre
- cd  Cassandre-travis-test/node
- node --version
- npm --version
- npm install express
- npm install express-http-proxy
- npm install async
- node app.js &
- cd ../..

before_script : 
- sudo apt-get update
- sudo apt-get install apache2 libapache2-mod-fastcgi
# enable php-fpm
- phpenv --version
- sudo cp ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf
- sudo a2enmod rewrite actions fastcgi alias
- echo "cgi.fix_pathinfo = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
- ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm
# configure apache virtual hosts
- ls
- sudo cp -f travis-build/travis-ci-apache /etc/apache2/sites-available/default
- sudo sed -e "s?%TRAVIS_BUILD_DIR%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
- sudo service apache2 restart

#test php
- ls
- curl 127.0.0.1/php/phpinfo.php

script: 
- ant test-argos
- ant test
